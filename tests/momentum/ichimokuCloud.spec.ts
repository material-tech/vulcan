import { describe, expect, it } from 'vitest'
import { ichimokuCloud } from '~/momentum/ichimokuCloud'
import ohlcv from '../ohlcv.json' with { type: 'json' }

describe('ichimoku cloud', () => {
  const data = ohlcv

  it('should able to calculate ichimoku cloud with default options', () => {
    const result = ichimokuCloud(data, { decimals: 2 })

    const expectedConversion = [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      171.33,
      171.33,
      171.33,
      171.33,
      170.98,
      170.77,
      170.66,
      169.69,
      169.67,
      170,
      170,
      170.31,
      171.83,
      172.99,
      172.99,
      172.99,
      173.41,
      173.41,
      173.41,
      173.41,
      173.21,
      172.62,
      172.62,
      172.62,
      172.32,
      172.42,
      172.42,
      172.42,
      172.42,
      173.31,
      174.51,
      174.51,
      174.87,
      174.87,
      174.87,
      174.87,
      174.87,
      174.87,
      174.87,
      173.59,
      172.4,
      172.14,
      172.07,
      169.77,
      166.65,
      164.47,
      163,
      162.69,
      160.81,
      160.81,
      160.81,
      160.81,
      161.66,
      162.53,
      162.53,
      162.53,
      162.53,
      166.57,
      170.51,
      171.68,
      174.81,
      175.12,
      175.12,
      175.12,
      175.12,
      175.12,
      175.12,
      175.12,
      176.01,
      176.57,
      176.57,
      176.57,
      176.57,
      176.57,
      176.57,
      176.57,
      176.05,
      174.22,
      172.73,
      172.59,
      172.03,
      171.21,
      170.64,
      169.81,
      169.81,
      169.81,
      169.81,
      169.81,
      169.35,
      169.35,
      169.74,
      170.3,
      170.48,
      173.57,
      173.57,
      174.29,
      172.18,
      171.51,
      170.08,
      170.08,
      170.08,
      169.79,
      169.73,
      168.01,
      169.19,
      169.19,
      172.44,
      174.15,
      174.15,
      174.15,
      176.1,
      177.82,
    ]

    const expectedBase = [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.83,
      171.91,
      174.08,
      174.08,
      174.44,
      174.66,
      174.66,
      174.66,
      174.66,
      174.66,
      174.66,
      173.59,
      172.4,
      172.4,
      172.4,
      170.1,
      168.05,
      167.05,
      167.05,
      167.05,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      164.91,
      165.36,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      166.31,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      170.5,
      172.57,
      173.19,
      174.22,
      174.22,
      174.22,
      174.22,
      174.22,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      173.99,
      172.5,
      172.36,
      171.6,
      170.08,
      170.08,
      170.08,
      169.79,
      169.79,
      169.79,
      169.79,
      169.79,
      172.44,
      174.15,
      174.15,
      174.15,
      175.5,
      175.5,
    ]

    const expectedLeadingA = [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      172.62,
      172.62,
      172.52,
      172.23,
      172.23,
      172.23,
      172.08,
      172.13,
      172.13,
      172.13,
      172.13,
      172.61,
      174.3,
      174.3,
      174.66,
      174.77,
      174.77,
      174.77,
      174.77,
      174.77,
      174.77,
      173.59,
      172.4,
      172.27,
      172.24,
      169.94,
      167.35,
      165.76,
      165.03,
      164.87,
      162.99,
      162.99,
      162.99,
      162.99,
      163.42,
      163.85,
      163.85,
      163.85,
      163.85,
      165.87,
      167.71,
      168.52,
      170.12,
      170.28,
      170.28,
      170.28,
      170.28,
      170.28,
      170.28,
      170.28,
      171.16,
      171.72,
      171.72,
      171.72,
      171.72,
      171.72,
      173.54,
      174.57,
      174.62,
      174.22,
      173.48,
      173.41,
      173.13,
      172.72,
      172.32,
      171.9,
      171.9,
      171.9,
      171.9,
      171.9,
      171.67,
      171.67,
      171.87,
      172.15,
      172.24,
      173.78,
      173.78,
      173.4,
      172.27,
      171.56,
      170.08,
      170.08,
      170.08,
      169.79,
      169.76,
      168.9,
      169.49,
      169.49,
      172.44,
      174.15,
      174.15,
      174.15,
      175.8,
      176.66,
    ]

    const expectedLeadingB = [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      170.1,
      168.05,
      167.05,
      167.05,
      167.05,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.17,
      165.36,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      165.43,
      166.31,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      166.87,
      170.5,
      172.07,
      172.07,
      172.07,
      172.07,
      172.07,
      172.44,
      174.15,
      174.15,
      174.15,
      175.5,
      175.5,

    ]

    const expectedLagging = [
      170.14,
      169.97,
      173.13,
      174.96,
      174.97,
      174.08,
      173.07,
      169.47,
      171.85,
      171.05,
      169.8,
      169.63,
      169,
      169.32,
      169.36,
      172.66,
      171.69,
      172.27,
      172.22,
      173.97,
      176.41,
      174.53,
      174.35,
      175,
      175,
      170.57,
      170.6,
      171.08,
      169.22,
      172.25,
      172.22,
      173.02,
      175,
      174.35,
      174.33,
      174.28,
      175.27,
      177.08,
      176.19,
      179.1,
      179.25,
      178.46,
      177,
      177.03,
      174.22,
      171.11,
      171.5,
      167.96,
      166.97,
      167.42,
      167.77,
      160.5,
      156.49,
      163.02,
      159.53,
      155.14,
      156.41,
      162.71,
      164.33,
      167.36,
      172.99,
      172.42,
      171.85,
      171.07,
      172.5,
      175.5,
      178.97,
      178.38,
      178.11,
      175,
      176.21,
      176.82,
      176.66,
      175.02,
      176.94,
      179.97,
      181.72,
      179.97,
      178.44,
      178.64,
      178.02,
      175.3,
      175.24,
      171.27,
      168.85,
      164.94,
      172.77,
      168.33,
      166.47,
      167.77,
      166.67,
      168.38,
      171.61,
      172.8,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
    ]

    expect(result.conversion)
      .toMatchNumberArray(expectedConversion, { digits: 2 })

    expect(result.base)
      .toMatchNumberArray(expectedBase, { digits: 2 })

    expect(result.leadingA)
      .toMatchNumberArray(expectedLeadingA, { digits: 2 })

    expect(result.leadingB)
      .toMatchNumberArray(expectedLeadingB, { digits: 2 })

    expect(result.lagging)
      .toMatchNumberArray(expectedLagging, { digits: 2 })
  })
})
